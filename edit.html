<!--
  Created by 2021 [ECD106] Charlie Shames, Thomas Nicolino, Ben Picone, Joseph Luciano; Advisor: Meghana Jain 
-->
<!DOCTYPE html>
<html>
<head>
    <title>Edit Imported Components</title>
    <link rel="stylesheet" type="text/css" href="styles/logicdesigner.css" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<script type="text/javascript">
	// Reads files locally using js
  	var storedShapes = JSON.parse(localStorage.getItem('storedShapes'));
	var deletedIDs = new Array();
	
	function handleSubmit(){
		var newShapes = new Array();
		for (var i=0; i<storedShapes.length; i++) {
			if ( !deletedIDs.includes(i) )
				newShapes.push(storedShapes[i]);
		}
		window.parent.openFile.setData(newShapes);
	}
	function hideWindow(cancel){
		window.parent.openFile.cancel(cancel);
	}
	function removeFile(id, name){
		deletedIDs.push(id);
		document.getElementById('fileRow-'+id).innerHTML = "";
	}
  	function nameIsUsed(id,name){
		for (var i=0; i<storedShapes.length; i++) {
			if((i!=id) && (name==storedShapes[i].componentName))
				return true;
		}
		return false;
	}
	function isNativeComponent ( component ){
		var native_components=["and", "nand", "or","nor","xor","xnor","buf", "inverter",
					"mux2","mux4", "mux8","mux16",
					"decoder2","decoder3","decoder4",
					"dff", "dff_en", "srlatch", "srlatch_en", "dlatch", "dlatch_en", 
					"fanIn2",  "fanIn4",  "fanIn8",  "fanIn16",  "fanIn32",
					"fanOut2",  "fanOut4", "fanOut8", "fanOut16", "fanOut32",
					"inputport1", "inputport2", "inputport4", "inputport8", "inputport16", "inputport32",
					"outputport1", "outputport2", "outputport4", "outputport8", "outputport16", "outputport32",
					"constant0", "constant1" ];
		return native_components.includes( component );
	};
	function isAlpha(c){
		return /^[A-Z]$/i.test(c);
	}
	function nameIsValid(id,name){
		var return_val = true;
		if ( (!isAlpha(name[0])) && (name[0]!='_') ) 
			return_val = false;
		if ( name.includes(' ') ) 
			return_val = false;
		return return_val;
	}
    function changeFileName(id,newName){
		if ( nameIsUsed(id,newName) || isNativeComponent(newName) ){
			alert('"'+ newName +'" already exists. Please change the name.');
		}
		else if ( !nameIsValid(id,newName) ) {
			alert('"'+ newName +'" is invalid. Please change the name.');
		}
		else {
			storedShapes[id].componentName = newName;
		}
    }
	function main(){	
		if (!window.parent.Editor.useLocalStorage)
		{
			var output="";
			var i;
			if (storedShapes!=null && storedShapes.length>0) {
				for (i=0; i<storedShapes.length; i++) {
					output += '<tr id="fileRow-'+i+'"> <td>'+(i+1)+'. </td> <td colspan="2" > <input style="width:100%" type="text" name="" onchange="changeFileName('+i+',this.value)" value="'+storedShapes[i].componentName+'"></td> <td><input type="button" value="X" onclick="removeFile('+i+')"></td> </tr>'
				}
			}
			document.getElementById("allFileNames").innerHTML = output;
		}
	};
</script>
<body onload="main();">
<form enctype="multipart/form-data" action="" onsubmit="return handleSubmit();" accept-charset="UTF-8">
<table style="width:100%;">
<tr>
<td style="vertical-align:top;" colspan="2">
</td>
</tr>
<tr>
<td colspan="2" height="" id="importSupported" style="font-family:arial;color:grey;font-size:9pt;vertical-align:top;text-align:left;">
</td>
</tr>
<tr>
  <table id="allFileNames" style="font-family:arial;color:grey;font-size:9pt;vertical-align:top;text-align:left;">
  </table>
</tr>
<tr>
<td>
</td>
<td style="margin-top: 10px;vertical-align:middle;text-align:right;white-space:nowrap;">
<input type="button" id="cancelButton" class="geBtn" value="Cancel" onclick="hideWindow(true);">
<input type="submit" id="saveButton" class="geBtn gePrimaryBtn" value="Save">
</td>
</tr>
</table>
</form>
</body>
</html>
